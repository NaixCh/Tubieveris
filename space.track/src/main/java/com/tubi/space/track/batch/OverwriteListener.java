package com.tubi.space.track.batch;

import javax.sql.DataSource;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.batch.core.ExitStatus;
import org.springframework.batch.core.StepExecution;
import org.springframework.batch.core.StepExecutionListener;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Component;

@Component
public class OverwriteListener implements StepExecutionListener {
	private static final Logger _log = LoggerFactory.getLogger(OverwriteListener.class);
	
	@Autowired
	DataSource datasource;

	@Override
	public void beforeStep(StepExecution stepExecution) {
		overwriteClear(datasource);
	}

	@Override
	public ExitStatus afterStep(StepExecution stepExecution) {
		_log.debug("Writed {} objects", stepExecution.getWriteCount());
		return null;
	}

	private void overwriteClear(DataSource datasource) {
		_log.info("Deleting all entries...");
		_log.info("\n ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,............\n ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,..........\n ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.........\n ,,,***********,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,........\n ,,,,,,,,,,,,,,,,,,,,,,,,*//((////(**,,,,,,,,,,,,,,,.......\n .,,,,,,,,,,,,,,,,,,,/##%%#%%&&&&%#%#//,,,,,,,,,,,,........\n .,,,,,,,,,,,,,,,,*#%&&&&@@&@@@@@@@@&&%(/...........,,,....\n ,*********,,,,,*%%%&&@@@@@@@@@@@@@@@&&%%#*.........*,,,...\n #&&&&&&&&&&&%%%&&&&@@@@@@&@@@@@@@@@@@@&&%%#*******........\n #&&&&&%%&&&&&&%&&@@@@&%#(((((#%&@@@@@@@&&&%%%%%%%%*.......\n #&&&&&&&&&&&&&&&@&&%(//**********/(##%&@&&&&%%%%&%/.......\n #%&&%%%##%%%(%&&@&#/********,,,,*,***/((#&&%%%%%&%(.......\n #&&&&((((/((#&@@%#//********,*,,,,,,,**///%##%%%&%(.......\n #&&&%&%&%&&&&&@@%#//*****,,,,,,,,,,,,,****(&&%%%&%#.......\n #&&&%%%%%%&&&&@@%(/#&&&&&&%#,,,,,,,,,*****/&&%%%&%#.......\n #&%&%%%%%%%&%&@&(/%%(((((###(***/((%&&&&&%/&&%%/&%#.......\n #%%%%%#(((///%@@#(((##(#####(/*//(####((/(#&%%%%&%%.......\n (###########/*%&(//#%#%%&#%###(((&%%&%%(((#.%%%#&%%.....%/\n (#%%%%%%%%%%(((&//*/((((###(##*.,%(#(%/((*,//%%#%%#.....(/\n (%%%%%%%&&&&(/(%/****/((/**///*,**//((//*,/((%%#%&%**#&&&*\n %@@@@@@@@@@@&/%&(//*/*/////((/*,**////*****(/%%%,,......./\n %@@@@@@@@@@@@//&%/////****(///*,**((/////**(%%%(,,......./\n %@@@@@@@@@@@@@/(&#((////**/#&%((#%/*****///(%%&*,,,.....,#\n %@@@@@@@@@@@@@@&&%##((/////#%&%&%(****////%%%%&@&&&&&&&&&%\n %@@@@%&&&&&&@/%@%&##((((%%%%%%%%%%#(///(/%&&&&%@@@&#(*.@@%\n %%@@@&&&&%%*/&&@(%&%%(/%&%%%@@@&%#%%%//(% (%%%&@@@%*.*((##\n %@&%%&%%%%%/&&&@((&&%#(%%#%((((((##%#/#%&&&%,,#@@%@@&%%((/\n (%%%&&@&&@%(&&@@&(#&%&&&%##%&@@&%###&##&&&&&&&%**(%%%%%(..\n #@@@@@@@@@%#&&@@@#(#@@@&&%%#%%&%##%&&&&&@&&&&%&&%%,,***//(\n (&&&@@@@@@&#&@@@@@#(#&@@&&&%%%%&&&&&@&&(&@@@@@&&&&&*.     \n #&%&&@@@@@&(%@@@@@&#((%%@@@@@@&@@@@@@&&&(%@@@@@&@@&@*     \n #&&&%&@@@&&#%@@@@@@&#(#####%%%%%##&@@&&&%/%@@@@&@@@@%,***,\n #&&@&@@@@@@%#@@@@@@&&#######%####@%&@&&&&#(&&&&@@@@@&&@%%%\n #@@@&@@@@@@&(%@@@@@@&&%###%%###%@@@&&&&&@@&@@@&@@@@@&&@%%%\n #&@@&@@@@@@@%#@@@@@@@@@&%%%%%#%@&@@@&@@&&&&@@@@@@@@@@@&%#%\n #&@@@@@@@@@@@(%@@@@@@@@@@@@%%&@@@&&&&@&%%%%&@@@@@@@@@@@&(#\n %@&@@@&&&&&@@@@@@@@@@@@@@@@@@@&&@@@@@&&%%&&&&&@@@@@@@@@&&#\n #&&@@@@@&@@@@&@@@@@@@@@@@@@@@@@@@@@@&&&&%%&@@@@@@@@@@@@@&%\n %@@&@@@@@@@@@&@@@@@@@@@@@@@@@&&@@@@@@&@@@@&@@@@@@@@@@@@@&#\n %@@@&@@@@@@@@&@@@@@@@@@&&@@@@@@&@@@@@@@@@@@@@@@@@@@@@@@@##");
		JdbcTemplate template = new JdbcTemplate(datasource);
		int deletedEntries = template.update("DELETE FROM DEBRIS");
		_log.info("Successfully deleted {} entries", deletedEntries);
	}
}
